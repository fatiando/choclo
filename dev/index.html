

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    
        <title>Choclo v0.0.post27</title>
    

    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/thebelab-helper.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="_static/design-tabs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="List of functions and classes (API)" href="api/index.html" />
    <!-- Plausible analytics for anonymous usage statistics -->
    <script defer data-domain="fatiando.org" src="https://plausible.io/js/plausible.js"></script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="#">
      
      
      
      <h1 class="site-logo" id="site-title">Choclo <span class="project-version">v0.0.post27</span></h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="api/index.html">
   List of functions and classes (API)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.gravity_pot.html">
     choclo.point.gravity_pot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.gravity_e.html">
     choclo.point.gravity_e
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.gravity_n.html">
     choclo.point.gravity_n
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.gravity_u.html">
     choclo.point.gravity_u
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.gravity_ee.html">
     choclo.point.gravity_ee
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.gravity_nn.html">
     choclo.point.gravity_nn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.gravity_uu.html">
     choclo.point.gravity_uu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.gravity_en.html">
     choclo.point.gravity_en
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.gravity_eu.html">
     choclo.point.gravity_eu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.gravity_nu.html">
     choclo.point.gravity_nu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.dipole.magnetic_e.html">
     choclo.dipole.magnetic_e
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.dipole.magnetic_n.html">
     choclo.dipole.magnetic_n
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.dipole.magnetic_u.html">
     choclo.dipole.magnetic_u
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.dipole.magnetic_field.html">
     choclo.dipole.magnetic_field
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.kernel_pot.html">
     choclo.point.kernel_pot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.kernel_e.html">
     choclo.point.kernel_e
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.kernel_n.html">
     choclo.point.kernel_n
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.kernel_u.html">
     choclo.point.kernel_u
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.kernel_ee.html">
     choclo.point.kernel_ee
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.kernel_nn.html">
     choclo.point.kernel_nn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.kernel_uu.html">
     choclo.point.kernel_uu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.kernel_en.html">
     choclo.point.kernel_en
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.kernel_eu.html">
     choclo.point.kernel_eu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.point.kernel_nu.html">
     choclo.point.kernel_nu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.gravity_pot.html">
     choclo.prism.gravity_pot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.gravity_e.html">
     choclo.prism.gravity_e
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.gravity_n.html">
     choclo.prism.gravity_n
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.gravity_u.html">
     choclo.prism.gravity_u
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.gravity_ee.html">
     choclo.prism.gravity_ee
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.gravity_nn.html">
     choclo.prism.gravity_nn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.gravity_uu.html">
     choclo.prism.gravity_uu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.gravity_en.html">
     choclo.prism.gravity_en
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.gravity_eu.html">
     choclo.prism.gravity_eu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.gravity_nu.html">
     choclo.prism.gravity_nu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.magnetic_field.html">
     choclo.prism.magnetic_field
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.magnetic_e.html">
     choclo.prism.magnetic_e
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.magnetic_n.html">
     choclo.prism.magnetic_n
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.magnetic_u.html">
     choclo.prism.magnetic_u
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.kernel_pot.html">
     choclo.prism.kernel_pot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.kernel_e.html">
     choclo.prism.kernel_e
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.kernel_n.html">
     choclo.prism.kernel_n
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.kernel_u.html">
     choclo.prism.kernel_u
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.kernel_ee.html">
     choclo.prism.kernel_ee
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.kernel_nn.html">
     choclo.prism.kernel_nn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.kernel_uu.html">
     choclo.prism.kernel_uu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.kernel_en.html">
     choclo.prism.kernel_en
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.kernel_eu.html">
     choclo.prism.kernel_eu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.prism.kernel_nu.html">
     choclo.prism.kernel_nu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.utils.distance_cartesian.html">
     choclo.utils.distance_cartesian
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.utils.distance_spherical.html">
     choclo.utils.distance_spherical
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.utils.distance_spherical_core.html">
     choclo.utils.distance_spherical_core
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.constants.GRAVITATIONAL_CONST.html">
     choclo.constants.GRAVITATIONAL_CONST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/generated/choclo.constants.VACUUM_MAGNETIC_PERMEABILITY.html">
     choclo.constants.VACUUM_MAGNETIC_PERMEABILITY
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="citing.html">
   Citing Choclo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="references.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="compatibility.html">
   Version compatibility
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Community
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="http://contact.fatiando.org">
   Join the community
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/fatiando/choclo/blob/main/CONTRIBUTING.md">
   How to contribute
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/fatiando/choclo/blob/main/CODE_OF_CONDUCT.md">
   Code of Conduct
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/fatiando/choclo">
   Source code on GitHub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://www.fatiando.org">
   The Fatiando a Terra project
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/fatiando/choclo"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/fatiando/choclo/issues/new?title=Issue%20on%20page%20%2Findex.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/fatiando/choclo/edit/main/doc/index.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/index.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Overview
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conventions">
   Conventions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-library">
   The library
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-use-choclo">
   How to use Choclo
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-simplest-case">
     The simplest case
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-sources-and-computation-points">
     Multiple sources and computation points
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parallelizing-our-runs">
     Parallelizing our runs
    </a>
    <ul class="nav section-nav flex-column">
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Overview</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Overview
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conventions">
   Conventions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-library">
   The library
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-use-choclo">
   How to use Choclo
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-simplest-case">
     The simplest case
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-sources-and-computation-points">
     Multiple sources and computation points
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parallelizing-our-runs">
     Parallelizing our runs
    </a>
    <ul class="nav section-nav flex-column">
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <h1 class="display-1">Choclo</h1>

<div class="sd-fs-3 sd-mb-4">
Kernel functions for your geophysical models
</div><p><strong>Choclo</strong> is a Python library that hosts optimized forward modelling and
kernel functions for running geophysical forward and inverse models, intended
to be used by other libraries as the underlying layer of their computation.</p>
<p>“Choclo” is a term used in some countries of South America to refer to corn,
originated from the <a class="reference external" href="https://en.wikipedia.org/wiki/Quechuan_languages">quechua</a>
word <em>chuqllu</em>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Choclo is a part of the
<a class="reference external" href="https://www.fatiando.org/">Fatiando a Terra</a> project.</p>
</div>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">#</a></h1>
<p>Choclo provides slim and optimized function to compute the gravitational and
magnetic fields of simple geometries like point masses, magnetic dipoles and
prisms. It also provides the <em>kernel</em> functions needed to run compute those
fields. The goal of Choclo is to provide developers of a simple and efficient
way to calculate these fields for a wide range of applications, like forward
modellings, sensitivity matrices calculations, equivalent sources
implementations and more.</p>
<p>These functions are not designed to be used by final users. Instead they are
meant to be part of the underlaying engine of a higher level codebase, like
<a class="reference external" href="https://www.fatiando.org/harmonica">Harmonica</a>.</p>
<p>All Choclo functions rely on <a class="reference external" href="https://numba.pydata.org/">Numba</a> for
just-in-time compilations, meaning that there’s no need to distribute
precompiled code: Choclo provides pure Python code that gets compiled during
runtime allowing to run them as fast as they were written in C.
Moreover, developers could harness the power of Numba to parallelize processes
in a quick and easy way.</p>
</section>
<section id="conventions">
<h1>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">#</a></h1>
<p>Before you jump into Choclo’s functions, it’s worth noting some conventions
that will be kept along its codebase:</p>
<ul class="simple">
<li><p>The functions assume a right-handed coordinate system. We avoid using names
like “x”, “y” and “z” for the coordinates. Instead we use “easting”,
“northing” and “upward” to make extra clear the direction of each axis.</p></li>
<li><p>We use the first letter of the <em>easting</em>, <em>northing</em> and <em>upward</em> axis to
indicate direction of derivatives. For example, a function <code class="docutils literal notranslate"><span class="pre">gravity_e</span></code> will
compute the <em>easting</em> component of the gravitional acceleration, while the
<code class="docutils literal notranslate"><span class="pre">gravity_n</span></code> and <code class="docutils literal notranslate"><span class="pre">gravity_u</span></code> will compute the <em>northing</em> and <em>upward</em>
ones, respectively.</p></li>
<li><p>The arguments of the functions are always assumed in SI units. And all the
functions return results also in SI units. Choclo <strong>doesn’t</strong> perform <strong>unit
conversions</strong>.</p></li>
<li><p>The components of the gravitational accelerations and the magnetic fields are
computed in the same direction of the <em>easting</em>, <em>northing</em> and <em>upward</em>
axis. So <code class="docutils literal notranslate"><span class="pre">gravity_u</span></code> will compute the <strong>upward</strong> component of the
gravitational acceleration (note the difference with the <strong>downward</strong>
component).</p></li>
</ul>
</section>
<section id="the-library">
<h1>The library<a class="headerlink" href="#the-library" title="Permalink to this headline">#</a></h1>
<p>Choclo is divided in a few different submodules, each with different goals. The
three main modules are the ones that host the forward and kernel functions for
the different geometries supported by Choclo: <code class="docutils literal notranslate"><span class="pre">point</span></code>, <code class="docutils literal notranslate"><span class="pre">dipole</span></code> and
<code class="docutils literal notranslate"><span class="pre">prism</span></code>. Inside each one of these modules we will find forward modelling
functions and potentially some kernel functions. The names of the forward
modelling functions follow a simple pattern of <code class="docutils literal notranslate"><span class="pre">{field}_{type}</span></code>. For
example, <a class="reference internal" href="api/generated/choclo.prism.gravity_e.html#choclo.prism.gravity_e" title="choclo.prism.gravity_e"><code class="xref py py-func docutils literal notranslate"><span class="pre">choclo.prism.gravity_e</span></code></a> computes the easting component of the
gravitational acceleration of a prism, while <a class="reference internal" href="api/generated/choclo.prism.gravity_ee.html#choclo.prism.gravity_ee" title="choclo.prism.gravity_ee"><code class="xref py py-func docutils literal notranslate"><span class="pre">choclo.prism.gravity_ee</span></code></a>
computes the easting-easting gravity tensor component.</p>
</section>
<section id="how-to-use-choclo">
<h1>How to use Choclo<a class="headerlink" href="#how-to-use-choclo" title="Permalink to this headline">#</a></h1>
<section id="the-simplest-case">
<h2>The simplest case<a class="headerlink" href="#the-simplest-case" title="Permalink to this headline">#</a></h2>
<p>Using Choclo is very simple, but it requires some work from our side. Let’s say
we need to compute the upward component of the gravitational acceleration that
a single rectangular prism produces on a single computation point. To do so we
can just call the <a class="reference internal" href="api/generated/choclo.prism.gravity_u.html#choclo.prism.gravity_u" title="choclo.prism.gravity_u"><code class="xref py py-func docutils literal notranslate"><span class="pre">choclo.prism.gravity_u</span></code></a> function:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">choclo.prism</span> <span class="kn">import</span> <span class="n">gravity_u</span>

<span class="c1"># Define a single computation point</span>
<span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">upward</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span>

<span class="c1"># Define the boundaries of the prism as a 1d-array</span>
<span class="n">prism</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">])</span>

<span class="c1"># And its density</span>
<span class="n">density</span> <span class="o">=</span> <span class="mf">400.0</span>

<span class="c1"># Compute the upward component of the grav. acceleration</span>
<span class="n">g_u</span> <span class="o">=</span> <span class="n">gravity_u</span><span class="p">(</span><span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">upward</span><span class="p">,</span> <span class="n">prism</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
<span class="n">g_u</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>-1.653643133689388e-07
</pre></div>
</div>
</div>
</div>
<p>But this case is very simple: we usually deal with multiple sources and
multiple computation points.</p>
</section>
<section id="multiple-sources-and-computation-points">
<h2>Multiple sources and computation points<a class="headerlink" href="#multiple-sources-and-computation-points" title="Permalink to this headline">#</a></h2>
<p>In case we have a collection of prisms with certain densities:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prisms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">densities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">200.0</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">400.0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>And a set of observation points:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">easting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">northing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">easting</span><span class="p">,</span> <span class="n">northing</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">))</span>
<span class="n">upward</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">easting</span><span class="p">)</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="p">(</span><span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">upward</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>And we want to compute the gratitational acceleration that those prisms
generate on each observation point, we need to write some kind of loop that
computes the effect of each prism on each observation point and adds it to
a running result.</p>
<p>A possible solution would be to use Python for loops:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gravity_upward_slow</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">prisms</span><span class="p">,</span> <span class="n">densities</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the upward component of the acceleration of a set of prisms</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Unpack coordinates of the observation points</span>
    <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">upward</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[:]</span>
    <span class="c1"># Initialize a result array full of zeros</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">easting</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="c1"># Compute the upward component that every prism generate on each</span>
    <span class="c1"># observation point</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">easting</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">prisms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">gravity_u</span><span class="p">(</span>
                <span class="n">easting</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">northing</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">upward</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">prisms</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">densities</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">g_u</span> <span class="o">=</span> <span class="n">gravity_upward_slow</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">prisms</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>
<span class="n">g_u</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>array([-3.08024767e-08, -3.10103482e-08, -3.11926215e-08, -3.13484961e-08,
       -3.14772466e-08, -3.15782275e-08, -3.16508775e-08, -3.16947240e-08,
       -3.17093869e-08, -3.16945831e-08, -3.16501302e-08, -3.15759501e-08,
       -3.14720725e-08, -3.13386380e-08, -3.11759003e-08, -3.09842280e-08,
       -3.07641061e-08, -3.05161358e-08, -3.02410339e-08, -2.99396310e-08,
       -2.96128686e-08, -3.11195000e-08, -3.13346703e-08, -3.15240617e-08,
       -3.16868368e-08, -3.18222319e-08, -3.19295618e-08, -3.20082244e-08,
       -3.20577056e-08, -3.20775840e-08, -3.20675354e-08, -3.20273375e-08,
       -3.19568737e-08, -3.18561377e-08, -3.17252367e-08, -3.15643944e-08,
       -3.13739539e-08, -3.11543785e-08, -3.09062534e-08, -3.06302842e-08,
       -3.03272966e-08, -2.99982325e-08, -3.14196998e-08, -3.16420877e-08,
       -3.18385422e-08, -3.20081895e-08, -3.21502273e-08, -3.22639303e-08,
       -3.23486553e-08, -3.24038461e-08, -3.24290393e-08, -3.24238686e-08,
       -3.23880705e-08, -3.23214892e-08, -3.22240807e-08, -3.20959177e-08,
       -3.19371927e-08, -3.17482213e-08, -3.15294445e-08, -3.12814294e-08,
       -3.10048696e-08, -3.07005838e-08, -3.03695135e-08, -3.17021952e-08,
       -3.19316874e-08, -3.21351185e-08, -3.23115780e-08, -3.24602255e-08,
       -3.25802955e-08, -3.26711033e-08, -3.27320505e-08, -3.27626308e-08,
       -3.27624353e-08, -3.27311588e-08, -3.26686047e-08, -3.25746907e-08,
       -3.24494538e-08, -3.22930541e-08, -3.21057787e-08, -3.18880444e-08,
       -3.16403995e-08, -3.13635238e-08, -3.10582283e-08, -3.07254524e-08,
       -3.19661435e-08, -3.22025940e-08, -3.24128819e-08, -3.25960611e-08,
       -3.27512529e-08, -3.28776521e-08, -3.29745324e-08, -3.30412529e-08,
       -3.30772642e-08, -3.30821145e-08, -3.30554558e-08, -3.29970507e-08,
       -3.29067776e-08, -3.27846366e-08, -3.26307546e-08, -3.24453891e-08,
       -3.22289318e-08, -3.19819108e-08, -3.17049911e-08, -3.13989744e-08,
       -3.10647971e-08, -3.22107451e-08, -3.24539745e-08, -3.26709663e-08,
       -3.28607390e-08, -3.30223766e-08, -3.31550343e-08, -3.32579446e-08,
       -3.33304242e-08, -3.33718804e-08, -3.33818184e-08, -3.33598474e-08,
       -3.33056883e-08, -3.32191797e-08, -3.31002846e-08, -3.29490955e-08,
       -3.27658396e-08, -3.25508827e-08, -3.23047313e-08, -3.20280348e-08,
       -3.17215845e-08, -3.13863123e-08, -3.24352494e-08, -3.26850446e-08,
       -3.29085531e-08, -3.31047592e-08, -3.32727101e-08, -3.34115219e-08,
       -3.35203866e-08, -3.35985787e-08, -3.36454629e-08, -3.36605008e-08,
       -3.36432592e-08, -3.35934170e-08, -3.35107730e-08, -3.33952522e-08,
       -3.32469127e-08, -3.30659504e-08, -3.28527044e-08, -3.26076592e-08,
       -3.23314471e-08, -3.20248483e-08, -3.16887888e-08, -3.26389589e-08,
       -3.28950733e-08, -3.31248774e-08, -3.33273224e-08, -3.35014197e-08,
       -3.36462472e-08, -3.37609571e-08, -3.38447825e-08, -3.38970454e-08,
       -3.39171650e-08, -3.39046654e-08, -3.38591840e-08, -3.37804794e-08,
       -3.36684390e-08, -3.35230855e-08, -3.33445839e-08, -3.31332455e-08,
       -3.28895323e-08, -3.26140588e-08, -3.23075927e-08, -3.19710535e-08,
       -3.28212346e-08, -3.30833883e-08, -3.33192332e-08, -3.35276885e-08,
       -3.37077309e-08, -3.38584016e-08, -3.39788135e-08, -3.40681594e-08,
       -3.41257196e-08, -3.41508714e-08, -3.41430967e-08, -3.41019920e-08,
       -3.40272760e-08, -3.39187982e-08, -3.37765467e-08, -3.36006546e-08,
       -3.33914057e-08, -3.31492385e-08, -3.28747492e-08, -3.25686922e-08,
       -3.22319792e-08, -3.29815001e-08, -3.32493807e-08, -3.34909783e-08,
       -3.37051816e-08, -3.38909341e-08, -3.40472413e-08, -3.41731784e-08,
       -3.42678988e-08, -3.43306425e-08, -3.43607454e-08, -3.43576487e-08,
       -3.43209081e-08, -3.42502033e-08, -3.41453465e-08, -3.40062911e-08,
       -3.38331385e-08, -3.36261448e-08, -3.33857248e-08, -3.31124558e-08,
       -3.28070782e-08, -3.24704949e-08, -3.31192457e-08, -3.33925095e-08,
       -3.36395397e-08, -3.38591960e-08, -3.40503903e-08, -3.42120940e-08,
       -3.43433462e-08, -3.44432623e-08, -3.45110433e-08, -3.45459852e-08,
       -3.45474893e-08, -3.45150719e-08, -3.44483743e-08, -3.43471723e-08,
       -3.42113849e-08, -3.40410824e-08, -3.38364930e-08, -3.35980079e-08,
       -3.33261849e-08, -3.30217497e-08, -3.26855958e-08, -3.32340324e-08,
       -3.35123058e-08, -3.37644175e-08, -3.39892003e-08, -3.41855361e-08,
       -3.43523641e-08, -3.44886890e-08, -3.45935899e-08, -3.46662305e-08,
       -3.47058685e-08, -3.47118667e-08, -3.46837034e-08, -3.46209825e-08,
       -3.45234445e-08, -3.43909748e-08, -3.42236131e-08, -3.40215600e-08,
       -3.37851831e-08, -3.35150205e-08, -3.32117829e-08, -3.28763531e-08,
       -3.33254950e-08, -3.36083762e-08, -3.38651893e-08, -3.40947420e-08,
       -3.42958885e-08, -3.44675377e-08, -3.46086619e-08, -3.47183060e-08,
       -3.47955980e-08, -3.48397595e-08, -3.48501163e-08, -3.48261102e-08,
       -3.47673097e-08, -3.46734205e-08, -3.45442961e-08, -3.43799459e-08,
       -3.41805438e-08, -3.39464337e-08, -3.36781342e-08, -3.33763402e-08,
       -3.30419234e-08, -3.33933450e-08, -3.36804060e-08, -3.39415134e-08,
       -3.41754516e-08, -3.43810495e-08, -3.45571878e-08, -3.47028085e-08,
       -3.48169248e-08, -3.48986312e-08, -3.49471148e-08, -3.49616670e-08,
       -3.49416949e-08, -3.48867329e-08, -3.47964541e-08, -3.46706805e-08,
       -3.45093929e-08, -3.43127390e-08, -3.40810394e-08, -3.38147931e-08,
       -3.35146792e-08, -3.31815574e-08, -3.34373730e-08, -3.37281623e-08,
       -3.39931319e-08, -3.42310457e-08, -3.44407092e-08, -3.46209775e-08,
       -3.47707650e-08, -3.48890551e-08, -3.49749115e-08, -3.50274894e-08,
       -3.50460476e-08, -3.50299609e-08, -3.49787315e-08, -3.48920015e-08,
       -3.47695634e-08, -3.46113702e-08, -3.44175443e-08, -3.41883839e-08,
       -3.39243683e-08, -3.36261607e-08, -3.32946084e-08, -3.34574503e-08,
       -3.37514954e-08, -3.40198732e-08, -3.42613296e-08, -3.44746493e-08,
       -3.46586642e-08, -3.48122637e-08, -3.49344043e-08, -3.50241213e-08,
       -3.50805406e-08, -3.51028913e-08, -3.50905176e-08, -3.50428922e-08,
       -3.49596280e-08, -3.48404898e-08, -3.46854042e-08, -3.44944694e-08,
       -3.42679617e-08, -3.40063416e-08, -3.37102559e-08, -3.33805389e-08,
       -3.34535302e-08, -3.37503405e-08, -3.40216536e-08, -3.42661995e-08,
       -3.44827449e-08, -3.46701015e-08, -3.48271362e-08, -3.49527814e-08,
       -3.50460472e-08, -3.51060327e-08, -3.51319398e-08, -3.51230852e-08,
       -3.50789142e-08, -3.49990128e-08, -3.48831198e-08, -3.47311373e-08,
       -3.45431403e-08, -3.43193846e-08, -3.40603115e-08, -3.37665521e-08,
       -3.34389272e-08, -3.34256488e-08, -3.37247189e-08, -3.39984781e-08,
       -3.42456436e-08, -3.44649665e-08, -3.46552412e-08, -3.48153152e-08,
       -3.49440999e-08, -3.50405826e-08, -3.51038392e-08, -3.51330469e-08,
       -3.51274979e-08, -3.50866127e-08, -3.50099526e-08, -3.48972326e-08,
       -3.47483320e-08, -3.45633044e-08, -3.43423853e-08, -3.40859983e-08,
       -3.37947583e-08, -3.34694725e-08, -3.33739245e-08, -3.36747374e-08,
       -3.39504412e-08, -3.41997427e-08, -3.44213805e-08, -3.46141346e-08,
       -3.47768360e-08, -3.49083782e-08, -3.50077294e-08, -3.50739448e-08,
       -3.51061803e-08, -3.51037064e-08, -3.50659214e-08, -3.49923646e-08,
       -3.48827295e-08, -3.47368744e-08, -3.45548329e-08, -3.43368218e-08,
       -3.40832472e-08, -3.37947084e-08, -3.34719985e-08, -3.32985579e-08,
       -3.36005885e-08, -3.38777261e-08, -3.41286699e-08, -3.43521490e-08,
       -3.45469319e-08, -3.47118364e-08, -3.48457414e-08, -3.49475987e-08,
       -3.50164466e-08, -3.50514228e-08, -3.50517789e-08, -3.50168939e-08,
       -3.49462882e-08, -3.48396356e-08, -3.46967757e-08, -3.45177238e-08,
       -3.43026790e-08, -3.40520311e-08, -3.37663636e-08, -3.34464556e-08,
       -3.31998300e-08, -3.35025487e-08, -3.37806038e-08, -3.40326898e-08,
       -3.42575292e-08, -3.44538820e-08, -3.46205563e-08, -3.47564193e-08,
       -3.48604103e-08, -3.49315535e-08, -3.49689717e-08, -3.49719010e-08,
       -3.49397041e-08, -3.48718848e-08, -3.47681001e-08, -3.46281729e-08,
       -3.44521018e-08, -3.42400699e-08, -3.39924510e-08, -3.37098137e-08,
       -3.33929226e-08])
</pre></div>
</div>
</div>
</div>
<p>For loops are known to be slow, and in case we are working with very large
models and a large number of computation points these calculations could take
too long. So this solution is not recommended.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Using Python for loops to run Choclo’s functions is not advisable!</p>
</div>
<p>We can write a much faster and efficient solution relying on <code class="xref py py-mod docutils literal notranslate"><span class="pre">numba</span></code>.
Since every function in Choclo is being JIT compiled, we can safely include
calls to these functions inside other JIT compiled functions. So we can write
an alterantive function by adding a <cite>&#64;numba.jit</cite> decorator:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numba</span>

<span class="nd">@numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">gravity_upward_jit</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">prisms</span><span class="p">,</span> <span class="n">densities</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the upward component of the acceleration of a set of prisms</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Unpack coordinates of the observation points</span>
    <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">upward</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[:]</span>
    <span class="c1"># Initialize a result array full of zeros</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">easting</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="c1"># Compute the upward component that every prism generate on each</span>
    <span class="c1"># observation point</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">easting</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">prisms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">gravity_u</span><span class="p">(</span>
                <span class="n">easting</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">northing</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">upward</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">prisms</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">densities</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">g_u</span> <span class="o">=</span> <span class="n">gravity_upward_jit</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">prisms</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>
<span class="n">g_u</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>array([-3.08024767e-08, -3.10103482e-08, -3.11926215e-08, -3.13484961e-08,
       -3.14772466e-08, -3.15782275e-08, -3.16508775e-08, -3.16947240e-08,
       -3.17093869e-08, -3.16945831e-08, -3.16501302e-08, -3.15759501e-08,
       -3.14720725e-08, -3.13386380e-08, -3.11759003e-08, -3.09842280e-08,
       -3.07641061e-08, -3.05161358e-08, -3.02410339e-08, -2.99396310e-08,
       -2.96128686e-08, -3.11195000e-08, -3.13346703e-08, -3.15240617e-08,
       -3.16868368e-08, -3.18222319e-08, -3.19295618e-08, -3.20082244e-08,
       -3.20577056e-08, -3.20775840e-08, -3.20675354e-08, -3.20273375e-08,
       -3.19568737e-08, -3.18561377e-08, -3.17252367e-08, -3.15643944e-08,
       -3.13739539e-08, -3.11543785e-08, -3.09062534e-08, -3.06302842e-08,
       -3.03272966e-08, -2.99982325e-08, -3.14196998e-08, -3.16420877e-08,
       -3.18385422e-08, -3.20081895e-08, -3.21502273e-08, -3.22639303e-08,
       -3.23486553e-08, -3.24038461e-08, -3.24290393e-08, -3.24238686e-08,
       -3.23880705e-08, -3.23214892e-08, -3.22240807e-08, -3.20959177e-08,
       -3.19371927e-08, -3.17482213e-08, -3.15294445e-08, -3.12814294e-08,
       -3.10048696e-08, -3.07005838e-08, -3.03695135e-08, -3.17021952e-08,
       -3.19316874e-08, -3.21351185e-08, -3.23115780e-08, -3.24602255e-08,
       -3.25802955e-08, -3.26711033e-08, -3.27320505e-08, -3.27626308e-08,
       -3.27624353e-08, -3.27311588e-08, -3.26686047e-08, -3.25746907e-08,
       -3.24494538e-08, -3.22930541e-08, -3.21057787e-08, -3.18880444e-08,
       -3.16403995e-08, -3.13635238e-08, -3.10582283e-08, -3.07254524e-08,
       -3.19661435e-08, -3.22025940e-08, -3.24128819e-08, -3.25960611e-08,
       -3.27512529e-08, -3.28776521e-08, -3.29745324e-08, -3.30412529e-08,
       -3.30772642e-08, -3.30821145e-08, -3.30554558e-08, -3.29970507e-08,
       -3.29067776e-08, -3.27846366e-08, -3.26307546e-08, -3.24453891e-08,
       -3.22289318e-08, -3.19819108e-08, -3.17049911e-08, -3.13989744e-08,
       -3.10647971e-08, -3.22107451e-08, -3.24539745e-08, -3.26709663e-08,
       -3.28607390e-08, -3.30223766e-08, -3.31550343e-08, -3.32579446e-08,
       -3.33304242e-08, -3.33718804e-08, -3.33818184e-08, -3.33598474e-08,
       -3.33056883e-08, -3.32191797e-08, -3.31002846e-08, -3.29490955e-08,
       -3.27658396e-08, -3.25508827e-08, -3.23047313e-08, -3.20280348e-08,
       -3.17215845e-08, -3.13863123e-08, -3.24352494e-08, -3.26850446e-08,
       -3.29085531e-08, -3.31047592e-08, -3.32727101e-08, -3.34115219e-08,
       -3.35203866e-08, -3.35985787e-08, -3.36454629e-08, -3.36605008e-08,
       -3.36432592e-08, -3.35934170e-08, -3.35107730e-08, -3.33952522e-08,
       -3.32469127e-08, -3.30659504e-08, -3.28527044e-08, -3.26076592e-08,
       -3.23314471e-08, -3.20248483e-08, -3.16887888e-08, -3.26389589e-08,
       -3.28950733e-08, -3.31248774e-08, -3.33273224e-08, -3.35014197e-08,
       -3.36462472e-08, -3.37609571e-08, -3.38447825e-08, -3.38970454e-08,
       -3.39171650e-08, -3.39046654e-08, -3.38591840e-08, -3.37804794e-08,
       -3.36684390e-08, -3.35230855e-08, -3.33445839e-08, -3.31332455e-08,
       -3.28895323e-08, -3.26140588e-08, -3.23075927e-08, -3.19710535e-08,
       -3.28212346e-08, -3.30833883e-08, -3.33192332e-08, -3.35276885e-08,
       -3.37077309e-08, -3.38584016e-08, -3.39788135e-08, -3.40681594e-08,
       -3.41257196e-08, -3.41508714e-08, -3.41430967e-08, -3.41019920e-08,
       -3.40272760e-08, -3.39187982e-08, -3.37765467e-08, -3.36006546e-08,
       -3.33914057e-08, -3.31492385e-08, -3.28747492e-08, -3.25686922e-08,
       -3.22319792e-08, -3.29815001e-08, -3.32493807e-08, -3.34909783e-08,
       -3.37051816e-08, -3.38909341e-08, -3.40472413e-08, -3.41731784e-08,
       -3.42678988e-08, -3.43306425e-08, -3.43607454e-08, -3.43576487e-08,
       -3.43209081e-08, -3.42502033e-08, -3.41453465e-08, -3.40062911e-08,
       -3.38331385e-08, -3.36261448e-08, -3.33857248e-08, -3.31124558e-08,
       -3.28070782e-08, -3.24704949e-08, -3.31192457e-08, -3.33925095e-08,
       -3.36395397e-08, -3.38591960e-08, -3.40503903e-08, -3.42120940e-08,
       -3.43433462e-08, -3.44432623e-08, -3.45110433e-08, -3.45459852e-08,
       -3.45474893e-08, -3.45150719e-08, -3.44483743e-08, -3.43471723e-08,
       -3.42113849e-08, -3.40410824e-08, -3.38364930e-08, -3.35980079e-08,
       -3.33261849e-08, -3.30217497e-08, -3.26855958e-08, -3.32340324e-08,
       -3.35123058e-08, -3.37644175e-08, -3.39892003e-08, -3.41855361e-08,
       -3.43523641e-08, -3.44886890e-08, -3.45935899e-08, -3.46662305e-08,
       -3.47058685e-08, -3.47118667e-08, -3.46837034e-08, -3.46209825e-08,
       -3.45234445e-08, -3.43909748e-08, -3.42236131e-08, -3.40215600e-08,
       -3.37851831e-08, -3.35150205e-08, -3.32117829e-08, -3.28763531e-08,
       -3.33254950e-08, -3.36083762e-08, -3.38651893e-08, -3.40947420e-08,
       -3.42958885e-08, -3.44675377e-08, -3.46086619e-08, -3.47183060e-08,
       -3.47955980e-08, -3.48397595e-08, -3.48501163e-08, -3.48261102e-08,
       -3.47673097e-08, -3.46734205e-08, -3.45442961e-08, -3.43799459e-08,
       -3.41805438e-08, -3.39464337e-08, -3.36781342e-08, -3.33763402e-08,
       -3.30419234e-08, -3.33933450e-08, -3.36804060e-08, -3.39415134e-08,
       -3.41754516e-08, -3.43810495e-08, -3.45571878e-08, -3.47028085e-08,
       -3.48169248e-08, -3.48986312e-08, -3.49471148e-08, -3.49616670e-08,
       -3.49416949e-08, -3.48867329e-08, -3.47964541e-08, -3.46706805e-08,
       -3.45093929e-08, -3.43127390e-08, -3.40810394e-08, -3.38147931e-08,
       -3.35146792e-08, -3.31815574e-08, -3.34373730e-08, -3.37281623e-08,
       -3.39931319e-08, -3.42310457e-08, -3.44407092e-08, -3.46209775e-08,
       -3.47707650e-08, -3.48890551e-08, -3.49749115e-08, -3.50274894e-08,
       -3.50460476e-08, -3.50299609e-08, -3.49787315e-08, -3.48920015e-08,
       -3.47695634e-08, -3.46113702e-08, -3.44175443e-08, -3.41883839e-08,
       -3.39243683e-08, -3.36261607e-08, -3.32946084e-08, -3.34574503e-08,
       -3.37514954e-08, -3.40198732e-08, -3.42613296e-08, -3.44746493e-08,
       -3.46586642e-08, -3.48122637e-08, -3.49344043e-08, -3.50241213e-08,
       -3.50805406e-08, -3.51028913e-08, -3.50905176e-08, -3.50428922e-08,
       -3.49596280e-08, -3.48404898e-08, -3.46854042e-08, -3.44944694e-08,
       -3.42679617e-08, -3.40063416e-08, -3.37102559e-08, -3.33805389e-08,
       -3.34535302e-08, -3.37503405e-08, -3.40216536e-08, -3.42661995e-08,
       -3.44827449e-08, -3.46701015e-08, -3.48271362e-08, -3.49527814e-08,
       -3.50460472e-08, -3.51060327e-08, -3.51319398e-08, -3.51230852e-08,
       -3.50789142e-08, -3.49990128e-08, -3.48831198e-08, -3.47311373e-08,
       -3.45431403e-08, -3.43193846e-08, -3.40603115e-08, -3.37665521e-08,
       -3.34389272e-08, -3.34256488e-08, -3.37247189e-08, -3.39984781e-08,
       -3.42456436e-08, -3.44649665e-08, -3.46552412e-08, -3.48153152e-08,
       -3.49440999e-08, -3.50405826e-08, -3.51038392e-08, -3.51330469e-08,
       -3.51274979e-08, -3.50866127e-08, -3.50099526e-08, -3.48972326e-08,
       -3.47483320e-08, -3.45633044e-08, -3.43423853e-08, -3.40859983e-08,
       -3.37947583e-08, -3.34694725e-08, -3.33739245e-08, -3.36747374e-08,
       -3.39504412e-08, -3.41997427e-08, -3.44213805e-08, -3.46141346e-08,
       -3.47768360e-08, -3.49083782e-08, -3.50077294e-08, -3.50739448e-08,
       -3.51061803e-08, -3.51037064e-08, -3.50659214e-08, -3.49923646e-08,
       -3.48827295e-08, -3.47368744e-08, -3.45548329e-08, -3.43368218e-08,
       -3.40832472e-08, -3.37947084e-08, -3.34719985e-08, -3.32985579e-08,
       -3.36005885e-08, -3.38777261e-08, -3.41286699e-08, -3.43521490e-08,
       -3.45469319e-08, -3.47118364e-08, -3.48457414e-08, -3.49475987e-08,
       -3.50164466e-08, -3.50514228e-08, -3.50517789e-08, -3.50168939e-08,
       -3.49462882e-08, -3.48396356e-08, -3.46967757e-08, -3.45177238e-08,
       -3.43026790e-08, -3.40520311e-08, -3.37663636e-08, -3.34464556e-08,
       -3.31998300e-08, -3.35025487e-08, -3.37806038e-08, -3.40326898e-08,
       -3.42575292e-08, -3.44538820e-08, -3.46205563e-08, -3.47564193e-08,
       -3.48604103e-08, -3.49315535e-08, -3.49689717e-08, -3.49719010e-08,
       -3.49397041e-08, -3.48718848e-08, -3.47681001e-08, -3.46281729e-08,
       -3.44521018e-08, -3.42400699e-08, -3.39924510e-08, -3.37098137e-08,
       -3.33929226e-08])
</pre></div>
</div>
</div>
</div>
<p>Let’s benchmark these two functions to see how much faster the decorated
function runs:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">gravity_upward_slow</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">prisms</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>3.32 ms ± 22.4 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
</div>
</div>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">gravity_upward_jit</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">prisms</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>600 µs ± 314 ns per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
</pre></div>
</div>
</div>
</div>
<p>From these numbers we can see that we have significantly reduced the
computation time by several factors by just decorating our function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The benchmarked times may vary if you run them in your system.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Check <a class="reference external" href="https://numba.readthedocs.io/en/stable/user/5minguide.html#how-to-measure-the-performance-of-numba">How to measure the performance of Numba?</a>
to learn more about how to properly benchmark jitted functions.</p>
</div>
</section>
<section id="parallelizing-our-runs">
<h2>Parallelizing our runs<a class="headerlink" href="#parallelizing-our-runs" title="Permalink to this headline">#</a></h2>
<p>We have already shown how we can reduce the computation times of our forward
modelling by decorating our functions with <cite>&#64;numba.jit(nopython=True)</cite>. But
this is just the first step: all the computations were being run in <em>serial</em> in
a single CPU. We can harness the full power of our modern multiprocessors CPUs
by parallelizing our runs. To do so we need to use the <code class="xref py py-func docutils literal notranslate"><span class="pre">numba.prange</span></code>
instead of the regular Python <cite>range</cite> function and slightly change the
decorator of our function by adding a <cite>parallel=True</cite>:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numba</span>

<span class="nd">@numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">gravity_upward_parallel</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">prisms</span><span class="p">,</span> <span class="n">densities</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the upward component of the acceleration of a set of prisms</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Unpack coordinates of the observation points</span>
    <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">upward</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[:]</span>
    <span class="c1"># Initialize a result array full of zeros</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">easting</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="c1"># Compute the upward component that every prism generate on each</span>
    <span class="c1"># observation point</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numba</span><span class="o">.</span><span class="n">prange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">easting</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">prisms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">gravity_u</span><span class="p">(</span>
                <span class="n">easting</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">northing</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">upward</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">prisms</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">densities</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">g_u</span> <span class="o">=</span> <span class="n">gravity_upward_parallel</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">prisms</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>
<span class="n">g_u</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>array([-3.08024767e-08, -3.10103482e-08, -3.11926215e-08, -3.13484961e-08,
       -3.14772466e-08, -3.15782275e-08, -3.16508775e-08, -3.16947240e-08,
       -3.17093869e-08, -3.16945831e-08, -3.16501302e-08, -3.15759501e-08,
       -3.14720725e-08, -3.13386380e-08, -3.11759003e-08, -3.09842280e-08,
       -3.07641061e-08, -3.05161358e-08, -3.02410339e-08, -2.99396310e-08,
       -2.96128686e-08, -3.11195000e-08, -3.13346703e-08, -3.15240617e-08,
       -3.16868368e-08, -3.18222319e-08, -3.19295618e-08, -3.20082244e-08,
       -3.20577056e-08, -3.20775840e-08, -3.20675354e-08, -3.20273375e-08,
       -3.19568737e-08, -3.18561377e-08, -3.17252367e-08, -3.15643944e-08,
       -3.13739539e-08, -3.11543785e-08, -3.09062534e-08, -3.06302842e-08,
       -3.03272966e-08, -2.99982325e-08, -3.14196998e-08, -3.16420877e-08,
       -3.18385422e-08, -3.20081895e-08, -3.21502273e-08, -3.22639303e-08,
       -3.23486553e-08, -3.24038461e-08, -3.24290393e-08, -3.24238686e-08,
       -3.23880705e-08, -3.23214892e-08, -3.22240807e-08, -3.20959177e-08,
       -3.19371927e-08, -3.17482213e-08, -3.15294445e-08, -3.12814294e-08,
       -3.10048696e-08, -3.07005838e-08, -3.03695135e-08, -3.17021952e-08,
       -3.19316874e-08, -3.21351185e-08, -3.23115780e-08, -3.24602255e-08,
       -3.25802955e-08, -3.26711033e-08, -3.27320505e-08, -3.27626308e-08,
       -3.27624353e-08, -3.27311588e-08, -3.26686047e-08, -3.25746907e-08,
       -3.24494538e-08, -3.22930541e-08, -3.21057787e-08, -3.18880444e-08,
       -3.16403995e-08, -3.13635238e-08, -3.10582283e-08, -3.07254524e-08,
       -3.19661435e-08, -3.22025940e-08, -3.24128819e-08, -3.25960611e-08,
       -3.27512529e-08, -3.28776521e-08, -3.29745324e-08, -3.30412529e-08,
       -3.30772642e-08, -3.30821145e-08, -3.30554558e-08, -3.29970507e-08,
       -3.29067776e-08, -3.27846366e-08, -3.26307546e-08, -3.24453891e-08,
       -3.22289318e-08, -3.19819108e-08, -3.17049911e-08, -3.13989744e-08,
       -3.10647971e-08, -3.22107451e-08, -3.24539745e-08, -3.26709663e-08,
       -3.28607390e-08, -3.30223766e-08, -3.31550343e-08, -3.32579446e-08,
       -3.33304242e-08, -3.33718804e-08, -3.33818184e-08, -3.33598474e-08,
       -3.33056883e-08, -3.32191797e-08, -3.31002846e-08, -3.29490955e-08,
       -3.27658396e-08, -3.25508827e-08, -3.23047313e-08, -3.20280348e-08,
       -3.17215845e-08, -3.13863123e-08, -3.24352494e-08, -3.26850446e-08,
       -3.29085531e-08, -3.31047592e-08, -3.32727101e-08, -3.34115219e-08,
       -3.35203866e-08, -3.35985787e-08, -3.36454629e-08, -3.36605008e-08,
       -3.36432592e-08, -3.35934170e-08, -3.35107730e-08, -3.33952522e-08,
       -3.32469127e-08, -3.30659504e-08, -3.28527044e-08, -3.26076592e-08,
       -3.23314471e-08, -3.20248483e-08, -3.16887888e-08, -3.26389589e-08,
       -3.28950733e-08, -3.31248774e-08, -3.33273224e-08, -3.35014197e-08,
       -3.36462472e-08, -3.37609571e-08, -3.38447825e-08, -3.38970454e-08,
       -3.39171650e-08, -3.39046654e-08, -3.38591840e-08, -3.37804794e-08,
       -3.36684390e-08, -3.35230855e-08, -3.33445839e-08, -3.31332455e-08,
       -3.28895323e-08, -3.26140588e-08, -3.23075927e-08, -3.19710535e-08,
       -3.28212346e-08, -3.30833883e-08, -3.33192332e-08, -3.35276885e-08,
       -3.37077309e-08, -3.38584016e-08, -3.39788135e-08, -3.40681594e-08,
       -3.41257196e-08, -3.41508714e-08, -3.41430967e-08, -3.41019920e-08,
       -3.40272760e-08, -3.39187982e-08, -3.37765467e-08, -3.36006546e-08,
       -3.33914057e-08, -3.31492385e-08, -3.28747492e-08, -3.25686922e-08,
       -3.22319792e-08, -3.29815001e-08, -3.32493807e-08, -3.34909783e-08,
       -3.37051816e-08, -3.38909341e-08, -3.40472413e-08, -3.41731784e-08,
       -3.42678988e-08, -3.43306425e-08, -3.43607454e-08, -3.43576487e-08,
       -3.43209081e-08, -3.42502033e-08, -3.41453465e-08, -3.40062911e-08,
       -3.38331385e-08, -3.36261448e-08, -3.33857248e-08, -3.31124558e-08,
       -3.28070782e-08, -3.24704949e-08, -3.31192457e-08, -3.33925095e-08,
       -3.36395397e-08, -3.38591960e-08, -3.40503903e-08, -3.42120940e-08,
       -3.43433462e-08, -3.44432623e-08, -3.45110433e-08, -3.45459852e-08,
       -3.45474893e-08, -3.45150719e-08, -3.44483743e-08, -3.43471723e-08,
       -3.42113849e-08, -3.40410824e-08, -3.38364930e-08, -3.35980079e-08,
       -3.33261849e-08, -3.30217497e-08, -3.26855958e-08, -3.32340324e-08,
       -3.35123058e-08, -3.37644175e-08, -3.39892003e-08, -3.41855361e-08,
       -3.43523641e-08, -3.44886890e-08, -3.45935899e-08, -3.46662305e-08,
       -3.47058685e-08, -3.47118667e-08, -3.46837034e-08, -3.46209825e-08,
       -3.45234445e-08, -3.43909748e-08, -3.42236131e-08, -3.40215600e-08,
       -3.37851831e-08, -3.35150205e-08, -3.32117829e-08, -3.28763531e-08,
       -3.33254950e-08, -3.36083762e-08, -3.38651893e-08, -3.40947420e-08,
       -3.42958885e-08, -3.44675377e-08, -3.46086619e-08, -3.47183060e-08,
       -3.47955980e-08, -3.48397595e-08, -3.48501163e-08, -3.48261102e-08,
       -3.47673097e-08, -3.46734205e-08, -3.45442961e-08, -3.43799459e-08,
       -3.41805438e-08, -3.39464337e-08, -3.36781342e-08, -3.33763402e-08,
       -3.30419234e-08, -3.33933450e-08, -3.36804060e-08, -3.39415134e-08,
       -3.41754516e-08, -3.43810495e-08, -3.45571878e-08, -3.47028085e-08,
       -3.48169248e-08, -3.48986312e-08, -3.49471148e-08, -3.49616670e-08,
       -3.49416949e-08, -3.48867329e-08, -3.47964541e-08, -3.46706805e-08,
       -3.45093929e-08, -3.43127390e-08, -3.40810394e-08, -3.38147931e-08,
       -3.35146792e-08, -3.31815574e-08, -3.34373730e-08, -3.37281623e-08,
       -3.39931319e-08, -3.42310457e-08, -3.44407092e-08, -3.46209775e-08,
       -3.47707650e-08, -3.48890551e-08, -3.49749115e-08, -3.50274894e-08,
       -3.50460476e-08, -3.50299609e-08, -3.49787315e-08, -3.48920015e-08,
       -3.47695634e-08, -3.46113702e-08, -3.44175443e-08, -3.41883839e-08,
       -3.39243683e-08, -3.36261607e-08, -3.32946084e-08, -3.34574503e-08,
       -3.37514954e-08, -3.40198732e-08, -3.42613296e-08, -3.44746493e-08,
       -3.46586642e-08, -3.48122637e-08, -3.49344043e-08, -3.50241213e-08,
       -3.50805406e-08, -3.51028913e-08, -3.50905176e-08, -3.50428922e-08,
       -3.49596280e-08, -3.48404898e-08, -3.46854042e-08, -3.44944694e-08,
       -3.42679617e-08, -3.40063416e-08, -3.37102559e-08, -3.33805389e-08,
       -3.34535302e-08, -3.37503405e-08, -3.40216536e-08, -3.42661995e-08,
       -3.44827449e-08, -3.46701015e-08, -3.48271362e-08, -3.49527814e-08,
       -3.50460472e-08, -3.51060327e-08, -3.51319398e-08, -3.51230852e-08,
       -3.50789142e-08, -3.49990128e-08, -3.48831198e-08, -3.47311373e-08,
       -3.45431403e-08, -3.43193846e-08, -3.40603115e-08, -3.37665521e-08,
       -3.34389272e-08, -3.34256488e-08, -3.37247189e-08, -3.39984781e-08,
       -3.42456436e-08, -3.44649665e-08, -3.46552412e-08, -3.48153152e-08,
       -3.49440999e-08, -3.50405826e-08, -3.51038392e-08, -3.51330469e-08,
       -3.51274979e-08, -3.50866127e-08, -3.50099526e-08, -3.48972326e-08,
       -3.47483320e-08, -3.45633044e-08, -3.43423853e-08, -3.40859983e-08,
       -3.37947583e-08, -3.34694725e-08, -3.33739245e-08, -3.36747374e-08,
       -3.39504412e-08, -3.41997427e-08, -3.44213805e-08, -3.46141346e-08,
       -3.47768360e-08, -3.49083782e-08, -3.50077294e-08, -3.50739448e-08,
       -3.51061803e-08, -3.51037064e-08, -3.50659214e-08, -3.49923646e-08,
       -3.48827295e-08, -3.47368744e-08, -3.45548329e-08, -3.43368218e-08,
       -3.40832472e-08, -3.37947084e-08, -3.34719985e-08, -3.32985579e-08,
       -3.36005885e-08, -3.38777261e-08, -3.41286699e-08, -3.43521490e-08,
       -3.45469319e-08, -3.47118364e-08, -3.48457414e-08, -3.49475987e-08,
       -3.50164466e-08, -3.50514228e-08, -3.50517789e-08, -3.50168939e-08,
       -3.49462882e-08, -3.48396356e-08, -3.46967757e-08, -3.45177238e-08,
       -3.43026790e-08, -3.40520311e-08, -3.37663636e-08, -3.34464556e-08,
       -3.31998300e-08, -3.35025487e-08, -3.37806038e-08, -3.40326898e-08,
       -3.42575292e-08, -3.44538820e-08, -3.46205563e-08, -3.47564193e-08,
       -3.48604103e-08, -3.49315535e-08, -3.49689717e-08, -3.49719010e-08,
       -3.49397041e-08, -3.48718848e-08, -3.47681001e-08, -3.46281729e-08,
       -3.44521018e-08, -3.42400699e-08, -3.39924510e-08, -3.37098137e-08,
       -3.33929226e-08])
</pre></div>
</div>
</div>
</div>
<p>With <code class="xref py py-func docutils literal notranslate"><span class="pre">numba.prange</span></code> we can specify which loop we want to run in parallel.
Since we are updating the values of <code class="docutils literal notranslate"><span class="pre">results</span></code> on each iteration, it’s
advisable to parallelize the loop over the observation points.
By setting <code class="docutils literal notranslate"><span class="pre">parallel=True</span></code> in the decorator we are telling Numba to
pararellize this function, otherwise Numba will reinterpret the <code class="docutils literal notranslate"><span class="pre">numba.prange</span></code>
function as a regular <code class="docutils literal notranslate"><span class="pre">range</span></code> and run this loop in serial.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In some applications it’s desirable that our forward models are run in
serial. For example, if they are part of larger problem that gets
parallelized at a higher level. The <code class="docutils literal notranslate"><span class="pre">parallel</span></code> parameter in the
<code class="docutils literal notranslate"><span class="pre">numba.jit</span></code> decorator allows us to change this behaviour at will without
having to modify the function code.</p>
</div>
<p>Let’s benchmark this function against the non-parallelized
<code class="docutils literal notranslate"><span class="pre">gravity_upward_jit</span></code>:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">gravity_upward_jit</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">prisms</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>600 µs ± 231 ns per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
</pre></div>
</div>
</div>
</div>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">gravity_upward_parallel</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">prisms</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>300 µs ± 256 ns per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
</pre></div>
</div>
</div>
</div>
<p>By distributing the load between multiple processors we were capable of
lowering the computation time by a few more factors.</p>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='right-next' id="next-link" href="api/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">List of functions and classes (API)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
      &copy; Copyright 2022, The Choclo Developers.<br/>
    Last updated on Nov 19, 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>